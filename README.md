# Learning Puppet


### What is Puppet?

- A Configuration Management Tool
- A framework for Systems Automation
- A Declarative Domain Specific Language (DSL)
- An OpenSource software in written Ruby
- Works on Linux, Unix (Solaris, AIX, *BSD), MacOS, Windows (Supported Platforms)

### Reference

- [Puppet Documentation](https://puppet.com/docs/)
- [Example42](https://blog.example42.com/tutorials/PuppetTutorial/)
- [Example42 in github](https://github.com/example42)
- [hackr.io](https://hackr.io/tutorials/learn-puppet)

### Software related to Puppet

- [Facter](https://puppet.com/docs/puppet/7/facter.html) - Complementary tool to retrieve system's data
- [MCollective](https://forge.puppet.com/modules/puppet/mcollective) - Infrastructure Orchestration framework
- [Hiera](https://github.com/puppetlabs/docs-archive/tree/main/hiera/1) - Key-value lookup tool where Puppet data can be placed
- [PuppetDB](https://puppet.com/docs/puppetdb/6/overview.html) - Stores all the data generated by Puppet
- Puppet DashBoard - A Puppet Web frontend and External Node Classifier (ENC)
- [The Foreman](https://theforeman.org/) - A well-known third party provisioning tool and Puppet ENC
- Geppetto - A Puppet IDE based on Eclipse

### Installation

- Debian, Ubuntu
    ```sh
    wget https://apt.puppet.com/puppet7-release-focal.deb && \
    sudo dpkg -i puppet7-release-focal.deb && \
    sudo apt update
    ```
    ```sh
    sudo apt install puppet-agent   # On Client (Nodes)
    sudo apt install puppetserver   # On Server (Master)
    ```


- RedHat, CentOS
    ```sh
    # this example is for RHEL8
    sudo rpm -Uvh https://yum.puppet.com/puppet7-release-el-8.noarch.rpm
    ```
    ```sh
    sudo yum install puppet-agent   # On Client (Nodes)
    sudo yum install puppetserver   # On Server (Master)
    ```
### Puppet Language
- A Declarative Domain Specific Language (**DSL**)
- It defines **STATES** (<ins>Not procedures</ins>)
- Puppet code is written in **manifests** (files with **.pp extension**)
- In the code we declare resources that affect elements of the system (files, packages, services ...)
- Resources are grouped in classes which may expose parameters that affect their behavior.
- Classes and configuration files are organized in **modules**.
- Consult the [official glossary](https://puppet.com/docs/puppet/7/glossary.html) to give the correct meaning to Puppet terms

### Nodes Classification

- When clients connect, the Puppet Master generates a **catalog** with the list of of the resources that clients have to apply locally.

- The Puppet Master has to classify nodes and define for each of them:
  - The **classes** to include
  - The **parameters** to pass
  - The Puppet **environment** to use

- The **catalog** is generated by the **Master** according to the logic of our Puppet code and data.
- In our code we can define our variables and use other ones that may come from different sources:
  - **facts** generated directly by the <ins>client</ins>.
  - **parameters** obtained from node's classification.
  - Puppet **internal** variables.

### Resource Types
- Resource Types are single units of configuration composed by:
  - A **type** (package, service, file, user, mount, exec ...)
  - A **title** (how is called and referred)
  - Zero or more **arguments**.
    ```
    type { 'title':
      argument  => value,
      other_arg => value,
    }
    ```
    Example for a **file** resource type:
    ```pp
    file { 'motd':
      path     => '/etc/motd',
      content  => 'Let's learning Puppet :)'
    }
    ```

### Resource Type refrence
- From the shell the command line interface:
    ```sh
    puppet describe file
    ```
- For the full list of available descriptions try:
    ```sh
    puppet describe --list
    ```
- Puppet code for the list of native resource types:
    ```sh
    ls $(facter rubysitedir)/puppet/type
    ```
### Simple sample of resources
- Installation of `OpenSSH` package
  ```pp
  package { 'openssh':
     ensure   => present,
  }
  ```
- Creation of `/etc/motd` file
  ```pp
  file { 'motd':
     path   => '/etc/motd',
  }
  ```
- Start of `http` service
  ```pp
  service { 'httpd':
      ensure => running,
      enable => true,
  }
  ```
